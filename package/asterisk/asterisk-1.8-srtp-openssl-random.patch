X-Git-Url: http://git.asterisk.org/gitweb/?p=asterisk%2Fasterisk.git;a=blobdiff_plain;f=res%2Fres_srtp.c;h=0193eb6036d2b29b32ffc9a00888503b6c7748b0;hp=54ce9e77d88f43768aedc040f5a52318512cd16a;hb=effa207bc420893d7d62e2acc674746b888d09eb;hpb=99efb23d111f596dadfeaa09c5710987fa03261c

diff --git a/res/res_srtp.c b/res/res_srtp.c
index 54ce9e7..0193eb6 100644
--- a/res/res_srtp.c
+++ b/res/res_srtp.c
@@ -41,6 +41,10 @@
 
 #include <srtp/srtp.h>
+#ifdef HAVE_OPENSSL
+#include <openssl/rand.h>
+#else
 #include <srtp/crypto_kernel.h>
+#endif
 
 #include "asterisk/lock.h"
 #include "asterisk/sched.h"
@@ -305,7 +309,11 @@ static int ast_srtp_policy_set_master_key(struct ast_srtp_policy *policy, const
 
 static int ast_srtp_get_random(unsigned char *key, size_t len)
 {
+#ifdef HAVE_OPENSSL
+	return RAND_bytes(key, len) > 0 ? 0: -1;
+#else
 	return crypto_get_random(key, len) != err_status_ok ? -1: 0;
+#endif
 }
 
 static void ast_srtp_set_cb(struct ast_srtp *srtp, const struct ast_srtp_cb *cb, void *data)
 
